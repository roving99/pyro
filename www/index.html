<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
    <link type="text/css" rel="stylesheet" href="www/stylesheet.css">

    <script type="text/javascript">
        var messageContainer = document.getElementById("messages");
        function WebSocketTest() {
            var messageContainer = document.getElementById("messages");
            if ("WebSocket" in window) {
                messageContainer.innerHTML = "WebSocket is supported by your Browser!";
                var ws = new WebSocket("ws://192.168.1.98:8888/ws?Id=123456789");

                ws.onopen = function() {
                    ws.send("Message to send");
                };

                ws.onmessage = actOnData;

                ws.onclose = function() { 
                    messageContainer.innerHTML = "Connection is closed...";
                };

            } else {
                messageContainer.innerHTML = "WebSocket NOT supported by your Browser!";
            }
        }

        function actOnData(evt) {
            var received_msg = evt.data;
            var messageContainer = document.getElementById("messages");
            var world = JSON.parse(received_msg); 

            messageContainer.innerHTML = received_msg;
         //   document.getElementById("sonar1").setAttribute("width",(world.sonar[0]*2).toString()+"px");
            var sonarWidth = document.getElementById("sonars").style.width 
            document.getElementById("sonar1").style.width = (100*(world.sonar[0]/300)).toString()+"%";
            document.getElementById("sonar2").style.width = (100*(world.sonar[1]/300)).toString()+"%";
            document.getElementById("sonar3").style.width = (100*(world.sonar[2]/300)).toString()+"%";
            document.getElementById("sonar4").style.width = (100*(world.sonar[3]/300)).toString()+"%";
            // document.getElementById("sonar4").style.width = (world.sonar[3]*2).toString()+"px";
            if (world.bump[0]) {
                document.getElementById("lbump").style.backgroundColor = "red";
                }
            else {
                document.getElementById("lbump").style.backgroundColor = "green";
                }
            if (world.bump[1]) {
                document.getElementById("rbump").style.backgroundColor = "red";
                }
            else {
                document.getElementById("rbump").style.backgroundColor = "green";
                }
            if (world.cliff[0]) {
                document.getElementById("lcliff").style.backgroundColor = "red";
                }
            else {
                document.getElementById("lcliff").style.backgroundColor = "green";
                }
            if (world.cliff[1]) {
                document.getElementById("rcliff").style.backgroundColor = "red";
                }
            else {
                document.getElementById("rcliff").style.backgroundColor = "green";
                }


        };
            
        </script>

    </head>

    <body>
        <div id="title">
            <h1>Robert 0.2</h1>
        </div>
        <a href="javascript:WebSocketTest()">Run WebSocket</a>
        <div id="messages"></div>
        <div id="bumpers" class = "indicators" style="display:inline-block;">
            <div id="lbump" class="led">left</div>
            <div id="rbump" class="led">right</div>
            <div id="lcliff" class="led">left</div>
            <div id="rcliff" class="led">right</div>
        </div>
        <div id="sonars" style="display:inline-block;">
            <div id="sonar1" class="bargraph">front</div>
            <div id="sonar2" class="bargraph">left</div>
            <div id="sonar3" class="bargraph">right</div>
            <div id="sonar4" class="bargraph">back</div>
        </div>
        <div>
          <p><img id="camera" src="http://192.168.1.98:8080/?action=stream"/></p>
        </div>
        <div id="footer">
        <div>
    </body>
</html>

